<html>
<head>
	<title>unittest for html_extractor</title>
	<script src="jsunittest/jsunittest.js" type="text/javascript"></script>
	<script src="../html_extractor.js" type="text/javascript"></script>
	<link rel="stylesheet" href="jsunittest/unittest.css" type="text/css" /> 
</head>
<body>
	<div id="testlog"></div>
</body>
</html>

<script type="text/javascript">
  new Test.Unit.Runner({
    setup: function() {
    },
    
    teardown: function() {
    },
	
		testBrockenHtml: function() { with(this) {
				var html = "<div><p>hello<p id='hello'><input id='input'><p>aa</div>";
				var jhe = html.jhe();
				html_extractor_log(HTMLtoXML(html));
				assertEqual("hello", jhe.tag("div").tag("p").im());		
		}},
		/*
	testEmptyTag: function() { with(this) {
		    var html = "<div><input id='hello'></div>";
			var ret = new html_extractor(html).tag("div").tag("input").ma("id");
			assertEqual("hello", ret);
		}},
 	testMatchTag: function() { with(this) {
			var html = '<div><p>text</p></div>';
			var ret = new html_extractor(html).match();
			assertEqual(1, ret.length, "test1");			
			assertEqual("<p>text</p>", ret[0], "test2");
		}},
	testMatchByAttr: function() { with(this) {
			var html = '<div class="t1"><a href="http://www.sina.com.cn">sina</a></div><div class="t1"><a href="http://www.google.cn">google</a></div>';
			var ret = new html_extractor(html).attr("class", "t1").tag("a").match();			
			assertEqual(2, ret.length);
			assertEqual("sina", ret[0]);
			assertEqual("google", ret[1]);
			
			var ret = new html_extractor(html).tag("*").attr("class", "t1").tag("a").match();			
			assertEqual(2, ret.length);
			assertEqual("sina", ret[0]);
			assertEqual("google", ret[1]);
						
			
		}},
	testMatchFirstTag: function() { with(this) {		
				var html = '<p><div><div><a href="http://www.sina.com.cn">text</a></div></div></p>';
				var ret = new html_extractor(html).first_tag("p").match();
				assertEqual(1, ret.length, "test1");			
				var ret = new html_extractor(html).first_tag("div").match();
				assertEqual(0, ret.length, "test2");							

			}},
	testMatchAttr: function() { with(this) {
			var html = '<a href="http://www.sina.com.cn">text</a>';
			var ret = new html_extractor(html).ma("href");
			assertEqual(1, ret.length);			
			assertEqual("http://www.sina.com.cn", ret[0]);
			
		}},
		
	testMatchText: function() { with(this) {
			var html = '<div><p>text</p></div>';
			var ret = new html_extractor(html).match_text();
			assertEqual(1, ret.length);			
			assertEqual("text", ret[0]);
		}},
		
    testChildMatch: function(){ with(this) {
		var html = "<div><div><div>item1</div></div></div>" +
		           "<div><p><div><div>item2</div></div></p></div>" + 
		           "<div><p><div><p><div>item3</div></p></div></p></div>" +
		           "<div><p><div><p><center><div>item4</div></center></p></div></p></div>";
		var extractor = new html_extractor(html);
		var ret  = extractor.tag("div").next_tag("div").next_tag("div").match();
		assertEqual(1, ret.length);
		assertEqual("item1", ret[0]);		

		ret  = extractor.tag("div").next_tag("div").match();
		assertEqual(2, ret.length);
		assertEqual("<div>item1</div>", ret[0]);				
		assertEqual("item2", ret[1]);						

		ret  = extractor.tag("div").next_tag("p").next_tag("div").next_tag("p").next_tag("div").match();
		assertEqual(1, ret.length);
		assertEqual("item3", ret[0]);			

		ret  = extractor.tag("div").next_tag("p").next_tag("div").next_tag("p").tag("div").match();
		assertEqual(2, ret.length);
		assertEqual("item3", ret[0]);					
		assertEqual("item4", ret[1]);	

		ret  = extractor.tag("div").tag("p").next_tag("center").match();
		assertEqual(1, ret.length);
		assertEqual("<div>item4</div>", ret[0]);															
	}},
		
    testMatch: function() { with(this) {
		var html = "<div><div><div id='aa'><a href='bb'>bb</a>aa</div></div></div>";
		ret = new html_extractor(html).tag("div").tag("div").tag("div").attr("id", "aa").match();
		assertEqual("<a href=\"bb\">bb</a>aa", ret[0]);
		ret = new html_extractor(html).tag("div").tag("div").tag("div").attr("id", "aa").match(false);		
		assertEqual("<div id=\"aa\"><a href=\"bb\">bb</a>aa</div>", ret[0]);

		html = '<div>' + 
			'<div id="div1"><span>list1</span><ul><li>item111</li><li>item12</li></ul></div>' +
			'<div id="div2"><span>list2</span><ul><li>item121</li><li><a href="http://www.sina.com.cn">item22</a></li><li>item123</li><li>item24</li></ul></div>' +
			'</div>';
			
		
		//ret = html.jhe().tag("div").tag("div").attr("id", /div\d*).im(function(idx, attrs, content)
			{
				var result = {};
				var extractor = new html_extractor(content);
				result.title = extractor.tag("span").match();
				result.items = extractor.tag("li").match();				
				return 		result;
			}
		);		
		assertEqual(2, ret.length);		
		assertEqual(2, ret[0].items.length);		
		assertEqual(4, ret[1].items.length);				
		assertEqual("list1", ret[0].title);		
		assertEqual("list2", ret[1].title);		

		assertEqual("item22", ret[1].items[1].jhe().im());	
		assertEqual("http://www.sina.com.cn", ret[1].items[1].jhe().ma("href"));	
					
		 

		var extractor = new html_extractor("<a href=\"http://www.sina.com.cn\">sina</a>")
		ret = extractor.tag("a").match_attr("href");
		assertEqual("http://www.sina.com.cn", ret[0]);				
		ret = extractor.tag("a").match();
		assertEqual("sina", ret[0]);		
		ret = extractor.tag("a").match(false);
		assertEqual('<a href="http://www.sina.com.cn">sina</a>', ret[0]);				

		var ret = new html_extractor("<div><div><div>aaa</div></div>").tag("div").match();
		assertEqual("<div><div>aaa</div></div>", ret);

    }},
*/
   testIm: function() { with(this) {
		//var html = "<div><p>abbc</div>";
   	    }},
   testOm: function() { with(this) {
   	    }},		
   testMa: function() { with(this) {
   	    }},		
   testHeIm: function() { with(this) {
   	    }},
   testHeOm: function() { with(this) {
   	    }},		
   testHeMa: function() { with(this) {
   	    }},				
  }); 
</script>